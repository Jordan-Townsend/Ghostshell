<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ghostshell MMO ‚Äì Secure Interface</title>
  <style>
    body { background: black; color: lime; font-family: monospace; padding: 2em; }
    #log { max-height: 300px; overflow-y: scroll; border: 1px solid lime; padding: 1em; background: #111; }
    .creator-panel { border: 1px dashed cyan; padding: 1em; margin-top: 1em; }
    .vr-panel { color: yellow; margin-top: 1em; }
  </style>
</head>
<body>
  <h1>üß¨ Ghostshell MMO Portal</h1>
  <div id="log">Initializing...</div>

  <input id="messageInput" placeholder="Cast symbolic action..." size="50">
  <button onclick="sendMessage()">Send</button>

  <div id="creatorPanel" class="creator-panel" style="display:none;">
    <h2>üëÅ Creator Panel</h2>
    <button onclick="sendMessage('system_ping')">Ping All</button>
    <button onclick="sendMessage('activate_overlay')">Activate Overlay</button>
    <p>Symbolic controls enabled for creator.</p>
  </div>

  <div id="xrPanel" class="vr-panel" style="display:none;">
    <h2>üï∂ Immersive Mode Active</h2>
    <p>WebXR activation placeholder loaded.</p>
  </div>

  <script>
    const params = new URLSearchParams(window.location.search);
    let role = params.get("role") || "Player";
    const mode = params.get("mode") || "2d";
    const passwordRequired = "symbolic42";  // üîê Secure creator password

    if (role.toLowerCase() === "creator") {
      const inputPassword = prompt("Enter Creator password:");
      if (inputPassword !== passwordRequired) {
        alert("‚ùå Incorrect password. Access denied.");
        window.location.href = "ghostshell-ui.html?role=Player&mode=" + mode;
        throw new Error("Access blocked");
      }
    }

    const nickname = role + "_" + Math.floor(Math.random() * 9999);
    const log = document.getElementById("log");
    const input = document.getElementById("messageInput");
    const socket = new WebSocket("wss://"ghostshell.onrender.com/ws");

    socket.onopen = () => {
      appendLog("üåê Connected as " + nickname);
      appendLog("üß† Role: " + role + " | Mode: " + mode);
    };

    socket.onmessage = (event) => {
      try {
        const data = JSON.parse(event.data);
        appendLog("üí¨ " + data.nickname + ": " + data.message);
      } catch (err) {
        appendLog("‚ö†Ô∏è Invalid message.");
      }
    };

    socket.onerror = () => {
      appendLog("‚ùå WebSocket failed to connect.");
    };

    function sendMessage(optionalMsg) {
      const msg = optionalMsg || input.value.trim();
      if (!msg) return;
      const payload = { nickname, message: msg };
      socket.send(JSON.stringify(payload));
      input.value = "";
    }

    function appendLog(msg) {
      const div = document.createElement("div");
      div.innerText = msg;
      log.appendChild(div);
      log.scrollTop = log.scrollHeight;
    }

    if (role.toLowerCase() === "creator") {
      document.getElementById("creatorPanel").style.display = "block";
    }

    if (mode === "vr" || mode === "ar") {
      document.getElementById("xrPanel").style.display = "block";
    }
  </script>
</body>
</html>
